<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="irma-web-server" value="https://demo.irmacard.org/tomcat/irma_api_server/server/" />
	<meta name="irma-api-server" value="https://demo.irmacard.org/tomcat/irma_api_server/api/v2/" />


	<title>IRMA Enrollment</title>
  <link href="/style/irma.css" rel="stylesheet" type="text/css" />
  <link href="http://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin" rel="stylesheet" type="text/css" />
  <link href="/style/bootstrap.css" rel="stylesheet" type="text/css" />
  <style>
    body { background-color: #ffffff; }
		div.huge {font-size: 300px; line-height: 1em;}
    #verify {cursor: pointer; }
	</style>

<script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
<script>

var attributes = {
	name: "${authenticated_user/fullName}"
}
var iprequest = {
    data: "foobar",
    timeout: 60,
    request: {
        "credentials": [
            {
                "credential": "irma-demo.Surfnet.root",
//                "validity": 1483228800,
                "attributes": {
                    "userID": "${authenticated_user/eduPersonPrincipalName}",
                    "securityHash": "00000000",
                }
            },
			{
                "credential": "irma-demo.MijnOverheid.fullName",
//                "validity": 1483228800,
                "attributes": {
                    "firstnames": "${authenticated_user/givenName}",
                    "firstname": "${authenticated_user/givenName}",
                    "familyname": "${authenticated_user/fullName}",
                    "prefix": " ",
                }
            }
        ],
   }
};

$(function() {
    var showWarning = function(msg) {
        $("#alert_box").html('<div class="alert alert-warning" role="alert">'
                             + '<strong>Warning:</strong> '
                             + msg + '</div>');
    };

    var showError = function (msg) {
        $("#alert_box").html('<div class="alert alert-danger" role="alert">'
                             + '<strong>Error:</strong> '
                             + msg + '</div>');
    };

    var success_fun = function(data) {
        $("#alert_box").html('<div class="alert alert-success" role="alert">'
                             + '<strong>Success:</strong> Credentials issued </div>');
    };

    $("#enroll").on("click", function() {
        var jwt = IRMA.createUnsignedJWT(iprequest);
        IRMA.issue(jwt, success_fun, showWarning, showError);
    });
});
</script>
</head>
<body>
  <div id="IRMA_verify">
    <div class="IRMA_page">
      <div class="IRMA_container">
        <div class="IRMA_title">
          IRMA ENROLLMENT
        </div>
    
        <div class="IRMA_logo_top">
          <img src="/style/irma_logo_1024px.png" width="264" height="211" />
        </div>
    
        <div class="IRMA_main_scherm">
        <div class="IRMA_content_verify">
<!-- content ... -->

<div id="alert_box"></div>


Logged in as ${authenticated_user/fullName}, <a href="?action=logout">Logout</a>

<hr />

<h3>Surf Federation attributes</h3>

<p>
Your Surf Federation attributes are:
</p>
      <table class="table"> 
		<tbody>
        <tr><th>Edu Person Principal Name</th><td tal:content="authenticated_user/eduPersonPrincipalName">Sample uid</td></tr> 
        <tr><th>Common Name</th><td tal:content="authenticated_user/fullName">Sample Full Name</td></tr> 
        <tr><th>Given Name</th><td tal:content="authenticated_user/givenName">Sample Given Name</td></tr> 
        <tr><th>Surname</th><td tal:content="authenticated_user/surname">Sample Surname</td></tr> 
		</tbody>
      </table>


<button id="enroll" class="btn-primary">
Enroll
</button>
<!-- ... content -->
        </div>
            
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="https://demo.irmacard.org/tomcat/irma_api_server/client/irma.js" ></script>
</body>
</html>
